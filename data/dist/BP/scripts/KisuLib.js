import{world as I}from"@minecraft/server";var p=class{constructor(){}getConfig(t){return new M(t)}clearAll(){let t=I.getDynamicPropertyIds();for(let e in t)e.startsWith("config.")&&I.setDynamicProperty(e)}},M=class{name;world;prefix;constructor(t){this.name=t,this.world=I,this.prefix=`config.${this.name}`}set(t){this.world.setDynamicProperty(`${this.prefix}`,JSON.stringify(t))}get(){let t=this.world.getDynamicProperty(`${this.prefix}`);return t?JSON.parse(t):{}}delete(){this.world.setDynamicProperty(`${this.prefix}`)}has(t){return this.get()[t]!==void 0}clear(){this.world.setDynamicProperty(`${this.prefix}`)}};var g=class{autoListeners=new Map;customListeners=new Map;subscriptions=new Map;onSubscribe;onUnsubscribe;setSubscriptionHandlers(t,e){this.onSubscribe=t,this.onUnsubscribe=e}hasListeners(t){let i=this.getListenerMap(t).get(t);return i!==void 0&&i.length>0}on(...t){typeof t[0]=="string"?this.addListener(t[0],t[1]):this.addListener(t[1],t[2],t[0])}addListener(t,e,i){let s=this.getListenerMap(t),r=this.hasListeners(t),n=s.get(t)??[];n.push({owner:i,cb:e}),s.set(t,n),!r&&this.onSubscribe&&!t.startsWith("Custom")&&this.onSubscribe(t)}off(...t){typeof t[0]=="string"?this.removeListener(t[0],void 0,t[1]):this.removeListener(t[1],t[0],t[2])}removeListener(t,e,i){let s=this.getListenerMap(t),r=s.get(t);if(!r)return;let n=e!==void 0?i!==void 0?r.filter(l=>!(l.owner===e&&l.cb===i)):r.filter(l=>l.owner!==e):r.filter(l=>l.cb!==i);s.set(t,n),n.length===0&&this.onUnsubscribe&&!t.startsWith("Custom")&&this.onUnsubscribe(t)}emit(t,e){let s=this.getListenerMap(t).get(t);if(s)for(let r of s)this.executeListener(r,e)}executeListener(t,e){try{if(t.owner&&!t.owner.isEnabled())return;t.cb(e)}catch{}}getListenerMap(t){return t.startsWith("Custom")?this.customListeners:this.autoListeners}};var u=class{prefix;constructor(t){this.prefix=t}log(t){this.msg(t,"LOG")}error(t){this.msg(t,"ERROR")}warn(t){this.msg(t,"WARN")}info(t){this.msg(t,"INFO")}debug(t){this.msg(t,"DEBUG")}msg(t,e){console.warn(`[${this.prefix}][${e}] ${t}`)}};import{system as H,world as W}from"@minecraft/server";import{world as D}from"@minecraft/server";var c=class{constructor(){}eachPlayer(t){let e=this.getAllPlayers();for(let i of e)t(i)}findPlayerByName(t){let e=this.getAllPlayers();for(let i of e)if(i.name===t)return i;return null}countPlayers(){return this.getAllPlayers().length}getAllPlayers(){return D.getPlayers()}isPlayerGameMode(t,e){return t.getGameMode()===e}};var C=new Map,E=class{plugin;constructor(t){this.plugin=t}registerItem(t){let e=new B(t,this.plugin);return C.set(t,e),e}getItemActions(t){return C.get(t)}},B=class{itemId;plugin;constructor(t,e){this.itemId=t,this.plugin=e}onUse(t){this.plugin.events.on("AfterItemUse",e=>{e.itemStack.typeId===this.itemId&&t(e.source,e.itemStack)})}onHitEntity(t){this.plugin.events.on("AfterEntityHurt",e=>{})}};var x=class{events;name="PluginBase";version="1.0.0";icon="";world;system;systemBase;settingMenu;playerManagers;itemActionManager;constructor(t,e){this.events=new h(this,t),this.world=W,this.system=H,this.systemBase=e,this.settingMenu=new d(this,this.getSettings()),this.playerManagers=new c,this.itemActionManager=new E(this),this.events.on("AfterWorldLoad",i=>{this.initializeConfig(),this.onLoad(i)})}get config(){return this.systemBase.configManager.getConfig(this.name)}get logger(){return new u(this.name.toUpperCase())}getName(){return this.name}onEnable(t){}onLoad(t){}onDisable(t){}isEnabled(){return!0}registerSettings(t){this.settingMenu=new t(this,this.getSettings())}getSettings(){return{}}initializeConfig(){let t=this.config.get();t||(this.config.set({}),t=this.config.get());let e=Object.keys(t).filter(i=>!(i in this.getSettings()));for(let i of e)delete t[i];for(let[i,s]of Object.entries(this.getSettings()))(!(i in t)||t[i].type!==s.type||t[i].description!==s.description||t[i].default!==s.default)&&(t[i]={...s,value:t[i]?.value??s.default});this.config.set(t)}};var m=class{plugins=new Map;eventHandlers;SystemBase;constructor(t,e){this.eventHandlers=t,this.SystemBase=e}registerPlugin(...t){for(let e of t){let i=new e(this.eventHandlers,this.SystemBase);this.plugins.set(i.name,i)}}getPlugin(t){return this.plugins.get(t)||null}getPlugins(){return Array.from(this.plugins.values())}isEnabled(t){return!!this.plugins.get(t)}};import{system as a,world as b}from"@minecraft/server";var P=class{world;system;configManager;events;pluginManagers;logger;settingMenuBuilders;playerManagers;options={settingItemType:"minecraft:clock"};eventSubscriptions=new Map;startTime=Date.now();constructor(t){this.world=b,this.system=a,this.events=new g,this.logger=new u("SYSTEM"),this.configManager=new p,this.pluginManagers=new m(this.events,this),this.settingMenuBuilders=new f,this.playerManagers=new c,t&&(this.options={...this.options,...t}),this.setupDynamicEventMapping(),this.initializeEvents()}initializeEvents(){this.events.on("AfterItemUse",t=>{t.itemStack.typeId===this.options.settingItemType&&this.settingMenuBuilders.settingMenu(t.source,this.pluginManagers)}),this.events.on("BeforeStartup",t=>this.onStartup(t)),this.events.on("BeforeShutdown",t=>this.onShutdown(t)),a.runInterval(()=>{this.events.emit("AfterTick",{currentTick:a.currentTick})})}setupDynamicEventMapping(){this.events.setSubscriptionHandlers(t=>this.subscribeToEvent(t),t=>this.unsubscribeFromEvent(t))}subscribeToEvent(t){if(this.eventSubscriptions.has(t))return;let e=t.startsWith("After"),i=t.replace(/^(After|Before)/,""),s=i.charAt(0).toLowerCase()+i.slice(1);if(e&&s in b.afterEvents){let r=s,n=b.afterEvents[r].subscribe(l=>{this.events.emit(t,l)});this.eventSubscriptions.set(t,n)}else if(!e&&s in b.beforeEvents){let r=s,n=b.beforeEvents[r].subscribe(l=>{this.events.emit(t,l)});this.eventSubscriptions.set(t,n)}else if(e&&s in a.afterEvents){let r=s,n=a.afterEvents[r].subscribe(l=>{this.events.emit(t,l)});this.eventSubscriptions.set(t,n)}else if(!e&&s in a.beforeEvents){let r=s,n=a.beforeEvents[r].subscribe(l=>{this.events.emit(t,l)});this.eventSubscriptions.set(t,n)}}unsubscribeFromEvent(t){let e=this.eventSubscriptions.get(t);e&&(e(),this.eventSubscriptions.delete(t))}onLoad(t){}onStartup(t){this.onLoad(t);let e=this.pluginManagers.getPlugins(),i=0;for(let s of e)s.onEnable(t),i++;a.run(()=>{let r=Date.now()-this.startTime;this.playerManagers.eachPlayer(n=>{n.sendToast("",`${"Plugin Loaded".mcColors().grey} (${i.toString().mcColors().green}/${e.length.toString().mcColors().red}) ${`in ${r}ms`.mcColors().grey}`,"textures/items/compass_item","textures/ui/greyBorder")})})}onShutdown(t){let e=this.pluginManagers.getPlugins();for(let i of e)i.onDisable(t)}};var f=class{menus=new Map;registerMenu(t,e){this.menus.set(e.name,t)}settingMenu(t,e){let i=e.getPlugins(),s=new v("Settings Menu",`\xA7fHello, \xA7e${t.name}\xA7r

This is the configuration menu.
You can manage settings here.`);s.addDivider(),s.addLabel(`\xA77Plugins (\xA7c${i.length}\xA77)\xA7r`);for(let r of i)this.addPluginButton(s,r,t,e);s.show(t)}addPluginButton(t,e,i,s){let r=new d(e,e.getSettings()),n=e.isEnabled()?"\xA72Enabled":"\xA7cDisabled";t.addButton(`${r.buttons.name}
\xA78[${n}\xA78]`,r.buttons.icon,()=>{this.showPluginSettingsPage(e,i,s)})}showPluginSettingsPage(t,e,i){new d(t,t.getSettings()).getPage().show(e).then(n=>{n.canceled||(this.savePluginSettings(t,n.formValues),this.settingMenu(e,i))})}savePluginSettings(t,e){let s=t.config.get()??{},n=Object.keys(t.getSettings()).filter(l=>t.getSettings()[l].canUserModify!==!1);for(let l=2;l<e.length-1;l++){let A=e[l];if(A===void 0)continue;let L=n[l-2],S=t.getSettings()[L];S&&(s[L]={...S,value:this.convertSettingValue(S.type,A)})}t.config.set(s)}convertSettingValue(t,e){switch(t){case"number":case"array":return Number(e);case"boolean":return!!e;default:return String(e)}}},d=class{plugin;settings;constructor(t,e){this.plugin=t,this.settings=e}get buttons(){return{name:this.plugin.name,description:`Settings for ${this.plugin.name.mcColors().blue} plugin`,icon:this.plugin.icon||"textures/items/compass_item"}}getPage(){let t=this.plugin.config.get()??{},e=new y(`${this.plugin.name} Settings`,"Save changes.");return e.addLabel(this.buttons.description.mcColors().grey),e.addDivider(),Object.keys(this.settings).length===0?(e.addLabel("\xA7cNo settings available for this plugin.\xA7r"),e.addDivider(),e):(this.addSettingFields(e,t),e.addDivider(),e)}addSettingFields(t,e){for(let[i,s]of Object.entries(this.settings)){if(s.canUserModify===!1)continue;let r=e[i]?.value,n=s.default;switch(s.type){case"boolean":t.addToggle(i,r??n,s.description);break;case"string":t.addTextField(i,s.description,r??n,s.description);break;case"number":t.addSlider(i,1,s.maxValue??100,1,r??n,s.description);break;case"array":t.addDropdown(i,n.map(String),typeof r=="number"?r:0,s.description);break}}}};var F=class{constructor(t){this.str=t}get grey(){return`\xA77${this.str}\xA7r`}get pink(){return`\xA7d${this.str}\xA7r`}get blackGray(){return`\xA78${this.str}\xA7r`}get darkRed(){return`\xA74${this.str}\xA7r`}get darkGreen(){return`\xA72${this.str}\xA7r`}get darkBlue(){return`\xA71${this.str}\xA7r`}get darkYellow(){return`\xA76${this.str}\xA7r`}get red(){return`\xA7c${this.str}\xA7r`}get green(){return`\xA7a${this.str}\xA7r`}get blue(){return`\xA79${this.str}\xA7r`}get yellow(){return`\xA7e${this.str}\xA7r`}get white(){return`\xA7f${this.str}\xA7r`}get black(){return`\xA70${this.str}\xA7r`}get bold(){return`\xA7l${this.str}\xA7r`}get italic(){return`\xA7o${this.str}\xA7r`}get underline(){return`\xA7n${this.str}\xA7r`}get strikethrough(){return`\xA7m${this.str}\xA7r`}get obfuscated(){return`\xA7k${this.str}\xA7r`}get reset(){return`\xA7r${this.str}`}};var h=class{plugin;eventHandlers;constructor(t,e){this.plugin=t,this.eventHandlers=e}on(t,e){this.eventHandlers.on(this.plugin,t,e)}emit(t,e){typeof t=="string"&&t.startsWith("Custom")?this.eventHandlers.emit(t,e):this.eventHandlers.emit(t,e)}};import{ActionFormData as $}from"@minecraft/server-ui";var v=class{title;body;elements=[];previousForm;constructor(t="",e="",i){this.title=t,this.body=e,i&&(this.previousForm=i)}back(t){this.previousForm&&this.previousForm(t)}setTitle(t){return this.title=t,this}setBody(t){return this.body=t,this}getTitle(){return this.title}getBody(){return this.body}addButtons(t){return this.elements.push(...t),this}addButton(t,e,i){return this.elements.push({label:t,icon:e,onClick:i}),this}addButtonObject(t){return this.elements.push(t),this}getButtons(){return this.elements.filter(this.isButton)}addDivider(){return this.elements.push({divider:!0}),this}getDividers(){return this.elements.filter(this.isDivider)}addHeader(t){return this.elements.push({text_header:t}),this}addHeaderObject(t){return this.elements.push(t),this}getHeader(){return this.elements.find(this.isHeader)}getHeaders(){return this.elements.filter(this.isHeader)}addLabel(t){return this.elements.push({text_label:t}),this}addLabelObject(t){return this.elements.push(t),this}getLabels(){return this.elements.filter(this.isLabel)}clearElements(){return this.elements=[],this}getElementCount(){return this.elements.length}hasButtons(){return this.getButtons().length>0}async show(t){let e=new $;e.title(this.title),e.body(this.body);let i=0,s=[];this.elements.forEach(r=>{this.isDivider(r)?e.divider():this.isHeader(r)?e.header(r.text_header):this.isLabel(r)?e.label(r.text_label):this.isButton(r)&&(e.button(r.label,r.icon),s[i]=r.onClick||(()=>{}),i++)}),e.body(this.body);try{let r=await e.show(t);if(!r.canceled&&r.selection!==void 0){let n=s[r.selection];n&&n()}return r}catch(r){throw console.error("Error showing form:",r),r}}isButton(t){return"label"in t}isDivider(t){return"divider"in t&&t.divider===!0}isHeader(t){return"text_header"in t}isLabel(t){return"text_label"in t}};import{MessageFormData as O}from"@minecraft/server-ui";var k=class o{title;body;button1=null;button2=null;constructor(t="",e=""){this.title=t,this.body=e}setTitle(t){return this.title=t,this}setBody(t){return this.body=t,this}getTitle(){return this.title}getBody(){return this.body}setButton1(t,e){return this.button1={text:t,onClick:e},this}setButton1Object(t){return this.button1=t,this}setButton2(t,e){return this.button2={text:t,onClick:e},this}setButton2Object(t){return this.button2=t,this}getButton1(){return this.button1}getButton2(){return this.button2}hasButton1(){return this.button1!==null}hasButton2(){return this.button2!==null}hasButtons(){return this.button1!==null||this.button2!==null}clearButtons(){return this.button1=null,this.button2=null,this}clearButton1(){return this.button1=null,this}clearButton2(){return this.button2=null,this}async show(t){let e=new O;e.title(this.title),e.body(this.body),this.button1&&e.button1(this.button1.text),this.button2&&e.button2(this.button2.text);try{let i=await e.show(t);return!i.canceled&&i.selection!==void 0&&(i.selection===0&&this.button1&&this.button1.onClick?this.button1.onClick():i.selection===1&&this.button2&&this.button2.onClick&&this.button2.onClick()),i}catch(i){throw console.error("Error showing message form:",i),i}}async showWithCallback(t,e){try{let i=await this.show(t);i.canceled?e(void 0,!0):e(i.selection,!1)}catch(i){console.error("Error in showWithCallback:",i),e(void 0,!0)}}static createConfirmation(t,e,i,s){return new o(t,e).setButton1("Cancel",s).setButton2("Confirm",i)}static createYesNo(t,e,i,s){return new o(t,e).setButton1("No",s).setButton2("Yes",i)}static createOK(t,e,i){return new o(t,e).setButton1("OK",i)}static createAlert(t,e,i){return new o(t,e).setButton1("Close",i)}};import{ModalFormData as K}from"@minecraft/server-ui";var y=class{title;elements=[];submitButtonText;callback;constructor(t="",e="Submit"){this.title=t,this.submitButtonText=e}setTitle(t){return this.title=t,this}getTitle(){return this.title}setSubmitButton(t){return this.submitButtonText=t,this}getSubmitButtonText(){return this.submitButtonText}addTextField(t,e,i,s){return this.elements.push({label:t,placeholderText:e,defaultValue:i,tooltip:s}),this}addTextFieldObject(t){return this.elements.push(t),this}getTextFields(){return this.elements.filter(this.isTextField)}addToggle(t,e,i){return this.elements.push({label:t,defaultValue:e,tooltip:i}),this}addToggleObject(t){return this.elements.push(t),this}getToggles(){return this.elements.filter(this.isToggle)}addSlider(t,e,i,s,r,n){return this.elements.push({label:t,minimumValue:e,maximumValue:i,valueStep:s,defaultValue:r,tooltip:n}),this}addSliderObject(t){return this.elements.push(t),this}getSliders(){return this.elements.filter(this.isSlider)}addDropdown(t,e,i,s){return this.elements.push({label:t,options:e,defaultValueIndex:i,tooltip:s}),this}addDropdownObject(t){return this.elements.push(t),this}getDropdowns(){return this.elements.filter(this.isDropdown)}addDivider(){return this.elements.push({divider:!0}),this}getDividers(){return this.elements.filter(this.isDivider)}addHeader(t){return this.elements.push({text_header:t}),this}addHeaderObject(t){return this.elements.push(t),this}getHeader(){return this.elements.find(this.isHeader)}getHeaders(){return this.elements.filter(this.isHeader)}addLabel(t){return this.elements.push({text_label:t}),this}addLabelObject(t){return this.elements.push(t),this}getLabels(){return this.elements.filter(this.isLabel)}clearElements(){return this.elements=[],this}getElementCount(){return this.elements.length}hasInputElements(){return this.elements.some(t=>this.isTextField(t)||this.isToggle(t)||this.isSlider(t)||this.isDropdown(t))}getElements(){return this.elements}addCallback(t){return this.callback=t,this}async show(t){let e=new K;e.title(this.title),e.submitButton(this.submitButtonText),this.elements.forEach(i=>{this.isDivider(i)?e.divider():this.isHeader(i)?e.label(i.text_header):this.isLabel(i)?e.label(i.text_label):this.isTextField(i)?e.textField(i.label,i.placeholderText||"",{defaultValue:i.defaultValue||"",tooltip:i.tooltip}):this.isToggle(i)?e.toggle(i.label,{defaultValue:i.defaultValue||!1,tooltip:i.tooltip}):this.isSlider(i)?e.slider(i.label,i.minimumValue,i.maximumValue,{defaultValue:i.defaultValue||0,valueStep:i.valueStep,tooltip:i.tooltip}):this.isDropdown(i)&&e.dropdown(i.label,i.options,{defaultValueIndex:i.defaultValueIndex||0,tooltip:i.tooltip})});try{return await e.show(t)}catch(i){throw console.error("Error showing modal form:",i),i}}async showWithCallback(t){try{let e=await this.show(t);e.canceled?this.callback?.([],!0):this.callback?.(e.formValues||[],!1)}catch(e){console.error("Error in showWithCallback:",e),this.callback?.([],!0)}}isTextField(t){return"label"in t&&"placeholderText"in t}isToggle(t){return"label"in t&&"defaultValue"in t&&typeof t.defaultValue=="boolean"}isSlider(t){return"minimumValue"in t&&"maximumValue"in t&&"valueStep"in t}isDropdown(t){return"options"in t&&Array.isArray(t.options)}isDivider(t){return"divider"in t&&t.divider===!0}isHeader(t){return"text_header"in t}isLabel(t){return"text_label"in t}};String.prototype.mcColors=function(){return new F(this.toString())};import{Player as T}from"@minecraft/server";function w(o="",t=100){return o.slice(0,t).padEnd(t,"	")}T.prototype.sendToast=function(o="",t="",e="",i="textures/ui/greyBorder"){let s="\xA7N\xA7O\xA7T\xA7I\xA7F\xA7I\xA7C\xA7A\xA7T\xA7I\xA7O\xA7N"+w(o,100)+w(t,200)+w(e,100)+w(i,100);this.sendMessage(s)};T.prototype.sendTopbar=function(o){this.onScreenDisplay.setTitle("ud0"+o)};T.prototype.stopTopbar=function(){this.onScreenDisplay.setTitle("ud0")};export{M as Config,p as ConfigManagers,g as EventHandlers,v as IActionForm,k as IMessageForm,y as IModalForm,u as Logger,F as MinecraftColors,x as PluginBase,h as PluginEventHandlers,m as PluginManagers,d as SettingMenu,f as SettingMenuBuilders,P as SystemBase};
//# sourceMappingURL=KisuLib.js.map
